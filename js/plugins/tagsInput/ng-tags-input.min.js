!function(){"use strict";var e={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,left:37,right:39,"delete":46,comma:188},t=9007199254740991,n=["text","email","url"],i=angular.module("ngTagsInput",[]);i.directive("inputChange",["$parse",function(){return{scope:{callBack:"=",isEditing:"="},link:function(e,t){t.on("input",function(){e.callBack(t.val(),e.isEditing)})}}}]),i.directive("selectAll",["$timeout","$parse",function(e,t){return{link:function(n,i,a){var o=t(a.selectAll);n.$watch(o,function(t){t===!0&&e(function(){i[0].focus(),i[0].select()})})}}}]),i.directive("tagsInput",["$timeout","$document","$window","tagsInputConfig","tiUtil",function(i,a,o,r,s){function u(e,t,n,i){var a,o,r,u,l,c,g={};return a=function(e){var t={};return l(t,e),o(t)},o=function(n){var i=u(n);return e.replaceSpacesWithDashes&&(i=s.replaceSpacesWithDashes(i)),l(n,i),c(n)?(g.items.push(n),t.trigger("tag-added",{$tag:n})):i&&t.trigger("invalid-tag",{$tag:n}),n},r=function(e){e.forEach(function(e){a(e)})},u=function(t){return s.safeToString(t[e.displayProperty])},l=function(t,n){t[e.displayProperty]=n},c=function(t){var i=u(t),a=i&&i.length>=e.minLength&&i.length<=e.maxLength&&e.allowedTagsPattern.test(i)&&n({$tag:t});return e.tagsRepeat||(a=a&&!s.findInObjectArray(g.items,t,e.keyProperty||e.displayProperty)),a},g.items=[],g.addText=function(t){var n=t.split(e.textSpiltPattern);r(n)},g.changeTag=function(t,n){var i=g.items.indexOf(t);if(-1!=i){var a=u(n);if(!a||a.length<=0)return void g.remove(i);var o=a.split(e.textSpiltPattern),s=o.shift();l(n,s),g.items[i]=n,r(o)}},g.remove=function(e){var n=g.items[e];return i({$tag:n})?(g.items.splice(e,1),g.clearSelection(),t.trigger("tag-removed",{$tag:n}),n):void 0},g.select=function(e){0>e?e=g.items.length-1:e>=g.items.length&&(e=0),g.index=e,g.selected=g.items[e]},g.selectPrior=function(){g.select(--g.index)},g.selectNext=function(){g.select(++g.index)},g.removeSelected=function(){return g.remove(g.index)},g.clearSelection=function(){g.selected=null,g.index=-1},g.clearSelection(),g}function l(e){return-1!==n.indexOf(e)}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",onTagAdding:"&",onTagAdded:"&",onInvalidTag:"&",onTagRemoving:"&",onTagRemoved:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function(e,n,i){e.events=s.simplePubSub(),r.load("tagsInput",e,n,{template:[String,"ngTagsInput/tag-item.html"],type:[String,"text",l],placeholder:[String,"Add a tag"],tabindex:[Number,null],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,3],maxLength:[Number,t],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],addOnPaste:[Boolean,!1],pasteSplitPattern:[RegExp,/,/],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number,0],maxTags:[Number,t],displayProperty:[String,"text"],keyProperty:[String,""],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1],spellcheck:[Boolean,!0],tagsRepeat:[Boolean,!1],textSpiltPattern:[RegExp,/\s|,/]}),e.tagList=new u(e.options,e.events,s.handleUndefinedResult(e.onTagAdding,!0),s.handleUndefinedResult(e.onTagRemoving,!0)),this.registerAutocomplete=function(){var t=i.find("input");return{selected:function(t){e.editing?e.tagList.changeTag(e.editingTag,t):e.tagList.addText(t[e.options.displayProperty])},focusInput:function(){t[0].focus()},getTags:function(){return e.tags},getCurrentTagText:function(){return e.newTag.text},getOptions:function(){return e.options},on:function(t,n){return e.events.on(t,n),this}}},this.registerTagItem=function(){return{getOptions:function(){return e.options},removeTag:function(t){e.disabled||e.tagList.remove(t)}}}}],link:function(t,n,r,u){var l,c=[e.enter,e.comma,e.space,e.backspace,e["delete"],e.left,e.right],g=t.tagList,d=t.events,p=t.options,f=n.find("input"),m=["minTags","maxTags","allowLeftoverText"];l=function(){u.$setValidity("maxTags",t.tags.length<=p.maxTags),u.$setValidity("minTags",t.tags.length>=p.minTags),u.$setValidity("leftoverText",t.hasFocus||p.allowLeftoverText?!0:!t.newTag.text)},u.$isEmpty=function(e){return!e||!e.length},t.editing=!1,t.editingTag,t.tagsDblClick=function(e){e.editable=!0,t.editing=!0,t.editingTag=e},t.editBlur=function(e,n){n.editable=!1,g.changeTag(t.editingTag,n),i(function(){f[0].focus()},50)},t.inputChange=function(e,n){d.trigger("input-change",e),t.editing=n},t.newTag={text:"",invalid:null,setText:function(e){this.text=e,d.trigger("input-change",e)}},t.track=function(e){return e[p.keyProperty||p.displayProperty]},t.$watch("tags",function(e){t.tags=s.makeObjectArray(e,p.displayProperty),g.items=t.tags}),t.$watch("tags.length",function(){l()}),r.$observe("disabled",function(e){t.disabled=e}),t.eventHandlers={input:{change:function(e){d.trigger("input-change",e)},keydown:function(e){d.trigger("input-keydown",e)},focus:function(){t.hasFocus||(t.hasFocus=!0,d.trigger("input-focus"))},blur:function(){i(function(){var e=a.prop("activeElement"),i=e===f[0],o=n[0].contains(e);(i||!o)&&(t.hasFocus=!1,d.trigger("input-blur"))})},paste:function(e){e.getTextData=function(){var t=e.clipboardData||e.originalEvent&&e.originalEvent.clipboardData;return t?t.getData("text/plain"):o.clipboardData.getData("Text")},d.trigger("input-paste",e)}},host:{click:function(){t.disabled||f[0].focus()}}},d.on("tag-added",t.onTagAdded).on("invalid-tag",t.onInvalidTag).on("tag-removed",t.onTagRemoved).on("tag-added",function(){t.newTag.setText("")}).on("tag-added tag-removed",function(){u.$setViewValue(t.tags)}).on("invalid-tag",function(){t.newTag.invalid=!0}).on("option-change",function(e){-1!==m.indexOf(e.name)&&l()}).on("input-change",function(){g.clearSelection(),t.newTag.invalid=null}).on("input-focus",function(){n.triggerHandler("focus"),u.$setValidity("leftoverText",!0)}).on("input-blur",function(){p.addOnBlur&&!p.addFromAutocompleteOnly&&g.addText(t.newTag.text),n.triggerHandler("blur"),l()}).on("input-keydown",function(i){var a,o,r,s,u=i.keyCode,l=i.shiftKey||i.altKey||i.ctrlKey||i.metaKey,d={};if(!l&&-1!==c.indexOf(u)){if(d[e.enter]=p.addOnEnter,d[e.comma]=p.addOnComma,d[e.space]=p.addOnSpace,a=!p.addFromAutocompleteOnly&&d[u],o=(u===e.backspace||u===e["delete"])&&g.selected,s=u===e.backspace&&0===t.newTag.text.length&&p.enableEditingLastTag&&!t.editing,r=(u===e.backspace||u===e.left||u===e.right)&&0===t.newTag.text.length&&!p.enableEditingLastTag,a)t.editing?n.find("input").blur():g.addText(t.newTag.text);else if(s){var f;g.selectPrior(),f=g.removeSelected(),f&&t.newTag.setText(f[p.displayProperty])}else o?g.removeSelected():r&&(u===e.left||u===e.backspace?g.selectPrior():u===e.right&&g.selectNext());(a||r||o||s)&&i.preventDefault()}}).on("input-paste",function(e){if(p.addOnPaste){var t=e.getTextData(),n=t.split(p.pasteSplitPattern);n.length>1&&(n.forEach(function(e){g.addText(e)}),e.preventDefault())}})}}}]),i.directive("tiTagItem",["tiUtil",function(e){return{restrict:"E",require:"^tagsInput",template:'<ng-include src="$$template"></ng-include>',scope:{data:"="},link:function(t,n,i,a){var o=a.registerTagItem(),r=o.getOptions();t.$$template=r.template,t.$$removeTagSymbol=r.removeTagSymbol,t.$getDisplayText=function(){return e.safeToString(t.data[r.displayProperty])},t.$removeTag=function(){o.removeTag(t.$index)},t.$watch("$parent.$index",function(e){t.$index=e})}}}]),i.directive("autoComplete",["$document","$timeout","$sce","$q","tagsInputConfig","tiUtil",function(t,n,i,a,o,r){function s(e,t,n){var i,o,s,u={};return s=function(){return t.tagsInput.keyProperty||t.tagsInput.displayProperty},i=function(e,n){return e.filter(function(e){return!r.findInObjectArray(n,e,s(),function(e,n){return t.tagsInput.replaceSpacesWithDashes&&(e=r.replaceSpacesWithDashes(e),n=r.replaceSpacesWithDashes(n)),r.defaultComparer(e,n)})})},u.reset=function(){o=null,u.items=[],u.visible=!1,u.index=-1,u.selected=null,u.query=null},u.show=function(){t.selectFirstMatch?u.select(0):u.selected=null,u.visible=!0},u.load=r.debounce(function(n,l){u.query=n;var c=a.when(e({$query:n}));o=c,c.then(function(e){c===o&&"undefined"!=typeof e&&(e=r.makeObjectArray(e.data||e,s()),t.tagsRepeat&&(e=i(e,l)),u.items=e.slice(0,t.maxResultsToShow),u.items.length>0?u.show():u.reset())})},t.debounceDelay),u.selectNext=function(){u.select(++u.index)},u.selectPrior=function(){u.select(--u.index)},u.select=function(e){0>e?e=u.items.length-1:e>=u.items.length&&(e=0),u.index=e,u.selected=u.items[e],n.trigger("suggestion-selected",e)},u.reset(),u}function u(e,t){var n=e.find("li").eq(t),i=n.parent(),a=n.prop("offsetTop"),o=n.prop("offsetHeight"),r=i.prop("clientHeight"),s=i.prop("scrollTop");s>a?i.prop("scrollTop",a):a+o>r+s&&i.prop("scrollTop",a+o-r)}return{restrict:"E",require:"^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",controller:["$scope","$element","$attrs",function(e,t,n){e.events=r.simplePubSub(),o.load("autoComplete",e,n,{template:[String,"ngTagsInput/auto-complete-match.html"],debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10],loadOnDownArrow:[Boolean,!1],loadOnEmpty:[Boolean,!1],loadOnFocus:[Boolean,!1],selectFirstMatch:[Boolean,!0],displayProperty:[String,""]}),e.suggestionList=new s(e.source,e.options,e.events),this.registerAutocompleteMatch=function(){return{getOptions:function(){return e.options},getQuery:function(){return e.suggestionList.query}}}}],link:function(t,n,i,a){var o,r=[e.enter,e.tab,e.escape,e.up,e.down],s=t.suggestionList,l=a.registerAutocomplete(),c=t.options,g=t.events;c.tagsInput=l.getOptions(),o=function(e){return e&&e.length>=c.minLength||!e&&c.loadOnEmpty},t.addSuggestionByIndex=function(e){s.select(e),t.addSuggestion()},t.addSuggestion=function(){var e=!1;return s.selected&&(l.selected(angular.copy(s.selected)),s.reset(),l.focusInput(),e=!0),e},t.track=function(e){return e[c.tagsInput.keyProperty||c.tagsInput.displayProperty]},l.on("tag-added invalid-tag input-blur",function(){s.reset()}).on("input-change",function(e){o(e)?s.load(e,l.getTags()):s.reset()}).on("input-focus",function(){var e=l.getCurrentTagText();c.loadOnFocus&&o(e)&&s.load(e,l.getTags())}).on("input-keydown",function(n){var i=n.keyCode,a=!1;if(-1!==r.indexOf(i))return s.visible?i===e.down?(s.selectNext(),a=!0):i===e.up?(s.selectPrior(),a=!0):i===e.escape?(s.reset(),a=!0):(i===e.enter||i===e.tab)&&(a=t.addSuggestion()):i===e.down&&t.options.loadOnDownArrow&&(s.load(l.getCurrentTagText(),l.getTags()),a=!0),a?(n.preventDefault(),n.stopImmediatePropagation(),!1):void 0}),g.on("suggestion-selected",function(e){u(n,e)})}}}]),i.directive("tiAutocompleteMatch",["$sce","tiUtil",function(e,t){return{restrict:"E",require:"^autoComplete",template:'<ng-include src="$$template"></ng-include>',scope:{data:"="},link:function(n,i,a,o){var r=o.registerAutocompleteMatch(),s=r.getOptions();n.$$template=s.template,n.$index=n.$parent.$index,n.$highlight=function(n){return s.highlightMatchedText&&(n=t.safeHighlight(n,r.getQuery())),e.trustAsHtml(n)},n.$getDisplayText=function(){return t.safeToString(n.data[s.displayProperty||s.tagsInput.displayProperty])}}}}]),i.directive("tiTranscludeAppend",function(){return function(e,t,n,i,a){a(function(e){t.append(e)})}}),i.directive("tiAutosize",["tagsInputConfig",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,i,a){var o,r,s=e.getTextAutosizeThreshold();o=angular.element('<span class="input"></span>'),o.css("display","none").css("visibility","hidden").css("width","auto").css("white-space","pre"),n.parent().append(o),r=function(e){var t,a=e;return angular.isString(a)&&0===a.length&&(a=i.placeholder),a&&(o.text(a),o.css("display",""),t=o.prop("offsetWidth"),o.css("display","none")),n.css("width",t?t+s+"px":""),e},a.$parsers.unshift(r),a.$formatters.unshift(r),i.$observe("placeholder",function(e){a.$modelValue||r(e)})}}}]),i.directive("tiBindAttrs",function(){return function(e,t,n){e.$watch(n.tiBindAttrs,function(e){angular.forEach(e,function(e,t){n.$set(t,e)})},!0)}}),i.provider("tagsInputConfig",function(){var e={},t={},n=3;this.setDefaults=function(t,n){return e[t]=n,this},this.setActiveInterpolation=function(e,n){return t[e]=n,this},this.setTextAutosizeThreshold=function(e){return n=e,this},this.$get=["$interpolate",function(i){var a={};return a[String]=function(e){return e},a[Number]=function(e){return parseInt(e,10)},a[Boolean]=function(e){return"true"===e.toLowerCase()},a[RegExp]=function(e){return new RegExp(e)},{load:function(n,o,r,s){var u=function(){return!0};o.options={},angular.forEach(s,function(s,l){var c,g,d,p,f,m;c=s[0],g=s[1],d=s[2]||u,p=a[c],f=function(){var t=e[n]&&e[n][l];return angular.isDefined(t)?t:g},m=function(e){o.options[l]=e&&d(e)?p(e):f()},t[n]&&t[n][l]?r.$observe(l,function(e){m(e),o.events.trigger("option-change",{name:l,newValue:e})}):m(r[l]&&i(r[l])(o.$parent))})},getTextAutosizeThreshold:function(){return n}}}]}),i.factory("tiUtil",["$timeout",function(e){var t={};return t.debounce=function(t,n){var i;return function(){var a=arguments;e.cancel(i),i=e(function(){t.apply(null,a)},n)}},t.makeObjectArray=function(e,t){return e=e||[],e.length>0&&!angular.isObject(e[0])&&e.forEach(function(n,i){e[i]={},e[i][t]=n}),e},t.findInObjectArray=function(e,n,i,a){var o=null;return a=a||t.defaultComparer,e.some(function(e){return a(e[i],n[i])?(o=e,!0):void 0}),o},t.defaultComparer=function(e,n){return t.safeToString(e).toLowerCase()===t.safeToString(n).toLowerCase()},t.safeHighlight=function(e,n){function i(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}if(!n)return e;e=t.encodeHTML(e),n=t.encodeHTML(n);var a=new RegExp("&[^;]+;|"+i(n),"gi");return e.replace(a,function(e){return e.toLowerCase()===n.toLowerCase()?"<em>"+e+"</em>":e})},t.safeToString=function(e){return angular.isUndefined(e)||null==e?"":e.toString().trim()},t.encodeHTML=function(e){return t.safeToString(e).replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;")},t.handleUndefinedResult=function(e,t){return function(){var n=e.apply(null,arguments);return angular.isUndefined(n)?t:n}},t.replaceSpacesWithDashes=function(e){return t.safeToString(e).replace(/\s/g,"-")},t.simplePubSub=function(){var e={};return{on:function(t,n){return t.split(" ").forEach(function(t){e[t]||(e[t]=[]),e[t].push(n)}),this},trigger:function(n,i){var a=e[n]||[];return a.every(function(e){return t.handleUndefinedResult(e,!0)(i)}),this}}},t}]),i.run(["$templateCache",function(e){e.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ng-click="eventHandlers.host.click()" ti-transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li ng-repeat="tag in tagList.items track by $index" ng-class="{ selected: tag == tagList.selected }"><ti-tag-item class="tag-item" data="tag" ng-hide="tag.editable" ng-dblclick="tagsDblClick(tag,$event)"></ti-tag-item><input class="input" ng-model="tag.text" ng-if="tag.editable" ng-blur="editBlur($event,tag)"  select-all=\'true\' ng-change="eventHandlers.input.change(tag.text)" ng-keydown="eventHandlers.input.keydown($event)" input-change call-back="inputChange" is-editing="true" ng-click="$event.stopPropagation();" ti-autosize=""></li></ul><input class="input" autocomplete="off" ng-model="newTag.text" ng-change="eventHandlers.input.change(newTag.text)" ng-keydown="eventHandlers.input.keydown($event)" ng-focus="eventHandlers.input.focus($event)" ng-blur="eventHandlers.input.blur($event)" ng-paste="eventHandlers.input.paste($event)" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ng-disabled="disabled" ti-bind-attrs="{type: options.type, placeholder: options.placeholder, tabindex: options.tabindex, spellcheck: options.spellcheck}" input-change call-back="inputChange" is-editing="false" ti-autosize=""></div></div>'),e.put("ngTagsInput/tag-item.html",'<span ng-bind="$getDisplayText()"></span> <a class="remove-button" ng-click="$removeTag()" ng-bind="$$removeTagSymbol"></a>'),e.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-if="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by track(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestionByIndex($index)" ng-mouseenter="suggestionList.select($index)"><ti-autocomplete-match data="item"></ti-autocomplete-match></li></ul></div>'),e.put("ngTagsInput/auto-complete-match.html",'<span ng-bind-html="$highlight($getDisplayText())"></span>')}])}();